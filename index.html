<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Path Finder</title>
    <link rel="stylesheet" href="style.css">
    <!-- NEW: Chart.js Dependency -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body class="dark-mode">
    <h1> Autonomous Path Finder </h1>
    <div class="main-container">
        <!-- Row 1, Col 1: Algo Settings -->
        <div class="card algo-settings-card">
            <div class="settings">
                <!-- Algorithm Settings Section -->
                <div class="settings-section">
                    <h4 class="collapsible-header" data-toggle="collapse" data-target="#algorithmSettingsContent">Algorithm Settings</h4>
                    <div id="algorithmSettingsContent" class="collapsible-content">
                        <div class="settings-group">
                            <div class="field">
                                <label for="algorithmSelect" title="The reinforcement learning algorithm used to update Q-values and learn the optimal policy.">Algorithm:</label>
                                <select id="algorithmSelect" title="The reinforcement learning algorithm used to update Q-values and learn the optimal policy.">
                                    <option value="q-learning" selected>Q-Learning</option>
                                    <option value="sarsa">SARSA</option>
                                    <option value="monte-carlo">Monte Carlo free</option>
                                </select>
                            </div>
                            <div class="field">
                                <label for="explorationStrategySelect" title="Method used by the agent to decide between exploring new actions and exploiting known good actions (Used for Q-Learning, SARSA, Expected SARSA, Monte Carlo, SR).">Exploration Strategy:</label>
                                <select id="explorationStrategySelect" title="Method used by the agent to decide between exploring new actions and exploiting known good actions (Used for Q-Learning, SARSA, Expected SARSA, Monte Carlo, SR).">
                                    <option value="epsilon-greedy" selected>Œµ-Greedy</option>
                                    <option value="random">Random</option>
                                    <option value="greedy">Greedy</option>
                                </select>
                            </div>
                            <div class="field field--slider">
                                <label for="lrSlider" title="Determines how much new information overrides old information. Higher values mean faster learning but potential instability.">Learning Rate (Œ±):</label>
                                <div class="slider-container">
                                    <input type="range" id="lrSlider" min="0.01" max="1" step="0.01" value="0.1" title="Determines how much new information overrides old information. Higher values mean faster learning but potential instability.">
                                    <span class="slider-value" id="lrValue">0.1</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="discountSlider" title="Determines the importance of future rewards.">Discount Factor (Œ≥):</label>
                                <div class="slider-container">
                                    <input type="range" id="discountSlider" min="0.1" max="1" step="0.01" value="0.9" title="Determines the importance of future rewards.">
                                    <span class="slider-value" id="discountValue">0.9</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="epsilonSlider" title="Controls the trade-off between exploration">Exploration Rate (Œµ):</label>
                                <div class="slider-container">
                                    <input type="range" id="epsilonSlider" min="0" max="1" step="0.01" value="0.2" title="Controls the trade-off between exploration.">
                                     <span class="slider-value" id="epsilonValue">0.2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Settings content ends -->
            </div>
            <!-- Reset Button moved HERE, directly under .card, after .settings -->
            <button class="btn btn--secondary" id="resetAgentButton" title="Reset agent.">Reset Algorithm</button>
        </div>

        <!-- Row 1, Col 2: Simulation -->
        <div class="card sim-card">
            <h4>Interactive Simulation</h4>
            <canvas id="gridCanvas" width="400" height="400"></canvas>
            <div class="controls">
                 <button class="btn btn--primary" id="startButton">Start Learning</button>
                 <button class="btn btn--secondary" id="stopButton">Stop Learning</button>
                  <button class="btn btn--secondary" id="showOptimalPathButton" title="Compute">Show Optimal Path</button>
                 <div class="status-lines" style="margin-top:8px;">
                     <div>Training time: <span id="learningTimeDisplay">‚Äî</span></div>
                 </div>
            </div>
        </div>

        <!-- Row 2, Col 1: Q-Values / Action Probs -->
        <div id="qValueDisplay" class="card  env-settings-card">
             <h4 class="collapsible-header" data-toggle="collapse" data-target="#qValueContent">Action Values Q(s,a)</h4>
             <div id="qValueContent" class="collapsible-content">
                <div class="q-grid">
                    <div class="q-cell q-up"><span class="q-arrow">‚Üë</span> <span id="qUp">0.00</span></div>
                    <div class="q-cell q-left"><span class="q-arrow">‚Üê</span> <span id="qLeft">0.00</span></div>
                    <div class="q-cell q-placeholder"></div> <!-- Center placeholder -->
                    <div class="q-cell q-right"><span class="q-arrow">‚Üí</span> <span id="qRight">0.00</span></div>
                    <div class="q-cell q-down"><span class="q-arrow">‚Üì</span> <span id="qDown">0.00</span></div>
                </div>
                <!-- Add Action Probability Display -->
                <h4 class="prob-title">Action Probabilities œÄ(a | s)</h4>
                <div class="p-grid">
                    <div class="p-cell p-up"><span class="p-arrow">‚Üë</span> <span id="pUp">0.25</span></div>
                    <div class="p-cell p-left"><span class="p-arrow">‚Üê</span> <span id="pLeft">0.25</span></div>
                    <div class="p-cell p-placeholder"></div> <!-- Center placeholder -->
                    <div class="p-cell p-right"><span class="p-arrow">‚Üí</span> <span id="pRight">0.25</span></div>
                    <div class="p-cell p-down"><span class="p-arrow">‚Üì</span> <span id="pDown">0.25</span></div>
                </div>
            </div>
        </div>
        <!-- Row 1, Col 3: Env Settings -->
         <div class="card q-card">
            <div class="settings">
                 <!-- Environment Settings Section -->
                 <div class="settings-section">
                      <h4 class="collapsible-header" data-toggle="collapse" data-target="#environmentSettingsContent">Environment Settings</h4>
                      <div id="environmentSettingsContent" class="collapsible-content">
                         <div class="settings-group">
                            <div class="field field--slider">
                                <label for="gridSizeSlider" title="Sets the width and height of the grid world (e.g., 5 means a 5x5 grid).">Grid Size:</label>
                                <div class="slider-container">
                                    <input type="range" id="gridSizeSlider" name="gridSize" value="5" min="2" max="10" step="1" title="Sets the width and height of the grid world (e.g., 5 means a 5x5 grid).">
                                    <span class="slider-value" id="gridSizeValue">5</span>
                                </div>
                            </div>
                            <div class="field">
                                <label for="cellDisplayModeSelect" title="Choose what to display in each grid cell: Value color, Value text, greedy Policy arrows, SR vector (agent/hover), or None.">Cell Display:</label>
                                <select id="cellDisplayModeSelect" title="Choose what to display in each grid cell: Value color, Value text, greedy Policy arrows, SR vector (agent/hover), or None.">
                                    <option value="none">None</option>
                                    <option value="values-color" selected>Value Color</option>
                                </select>
                            </div>
                            <div class="field field--slider">
                                <label for="stepPenaltySlider" title="The negative reward received for each step taken that doesn't reach a goal or obstacle. Encourages shorter paths.">Step Penalty:</label>
                                <div class="slider-container">
                                    <input type="range" id="stepPenaltySlider" name="stepPenalty" value="-0.1" min="-2.0" max="0" step="0.1" title="The negative reward received for each step taken that doesn't reach a goal or obstacle. Encourages shorter paths.">
                                    <span class="slider-value" id="stepPenaltyValue">-0.1</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="gemRewardSlider" title="The reward received for landing on a gem (üíé).">Gem Reward:</label>
                                <div class="slider-container">
                                    <input type="range" id="gemRewardSlider" name="gemReward" value="10" min="1" max="20" step="1" title="The reward received for landing on a gem (üíé).">
                                    <span class="slider-value" id="gemRewardValue">10</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="badStateRewardSlider" title="The reward (penalty) received for landing on a skull.">Fire Penalty:</label>
                                <div class="slider-container">
                                    <input type="range" id="badStateRewardSlider" name="badStateReward" value="-10" min="-20" max="-1" step="1" title="The reward (penalty) received for landing on a skull (‚ò†Ô∏è).">
                                    <span class="slider-value" id="badStateRewardValue">-10</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="maxStepsSlider" title="Maximum number of steps allowed in an episode before it automatically resets.">Max Steps (per episode):</label>
                                <div class="slider-container">
                                    <input type="range" id="maxStepsSlider" name="maxSteps" value="100" min="10" max="500" step="10" title="Maximum number of episode.">
                                    <span class="slider-value" id="maxStepsValue">100</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="maxEpisodeSlider" title="Maximum number of training episodes to run before stopping automatically. Set to 0 for unlimited.">Max Episodes (training):</label>
                                <div class="slider-container">
                                    <input type="range" id="maxEpisodeSlider" name="maxEpisode" value="0" min="0" max="500" step="1" title="Maximum number of training episodes to run before stopping automatically. Set to 0 for unlimited.">
                                    <span class="slider-value" id="maxEpisodeValue">0</span>
                                </div>
                            </div>
                            <div class="field field--slider">
                                <label for="speedSlider" title="Controls the speed of the simulation. Higher values mean faster simulation (shorter delay between steps).">Speed:</label>
                                <div class="slider-container">
                                    <input type="range" id="speedSlider" min="10" max="1000" step="10" value="750" title="Controls the speed of the simulation. Higher values mean faster simulation (shorter delay between steps).">
                                     <span class="slider-value" id="speedValue">750</span> <!-- Displaying inverted value, JS will handle logic -->
                                </div>
                            </div>
                            <div class="field field--row"> <!-- Use field--row for checkbox layout -->
                                <input type="checkbox" id="terminateOnRewardCheckbox" checked title="If checked, the episode ends immediately when the agent reaches a reward state.">
                                <label for="terminateOnRewardCheckbox" title="If checked, the episode ends immediately when the agent reaches a reward state.">Terminate on Reward</label> <!-- Label after checkbox -->
                            </div>
                         </div>
                     </div>
                 </div>
                 <!-- Settings content ends -->
             </div>
             <!-- Reset Button moved HERE, directly under .card, after .settings -->
             <button class="btn btn--secondary" id="resetEnvironmentButton" title="Reset environment layout (rewards, walls, start) to default, keeping agent's learned Q-values.">Reset Environment</button>
         </div>

        <!-- Row 2, Cols 2-3: Progress Chart -->
        <div class="card progress-card">
            <h4 class="collapsible-header" data-toggle="collapse" data-target="#rewardChartContent">Learning Progress Plot</h4>
            <div id="rewardChartContent" class="collapsible-content">
                <div class="chart-container">
                    <canvas id="rewardChartCanvas"></canvas>
                </div>
            </div>
        </div>
    </div> <!-- End main-container -->

    <script type="module" src="script.js"></script>
    <footer class="copyright-footer">
        <p>¬© 2025 Autonomous Path Finder</p>
    </footer>
</body>
</html> 